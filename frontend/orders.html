<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>My Orders ‚Äî FoodExpress</title>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root { --orange: #FF5200; --orange-pale: #FFF3EE; --dark: #1C1C1C; --gray: #686B78; --light-gray: #F4F4F5; --border: #E8E8E8; }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Plus Jakarta Sans', sans-serif; background: var(--light-gray); color: var(--dark); }
    nav { background: white; border-bottom: 1px solid var(--border); padding: 0 5%; height: 64px; display: flex; align-items: center; justify-content: space-between; position: sticky; top:0; z-index:100; box-shadow: 0 2px 12px rgba(0,0,0,0.06); }
    .nav-logo { display: flex; align-items: center; gap: 8px; text-decoration: none; }
    .nav-logo .logo-icon { width: 36px; height: 36px; background: var(--orange); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 18px; }
    .nav-logo span { font-size: 20px; font-weight: 800; color: var(--dark); }
    .nav-logo span em { color: var(--orange); font-style: normal; }
    nav a { color: var(--gray); text-decoration: none; font-size: 14px; font-weight: 500; }
    nav a:hover { color: var(--orange); }

    .container { max-width: 800px; margin: 32px auto; padding: 0 20px; }

    .page-header { margin-bottom: 24px; }
    .page-header h1 { font-size: 28px; font-weight: 800; margin-bottom: 4px; }
    .page-header p { color: var(--gray); font-size: 14px; }

    /* Search bar */
    .search-card { background: white; border-radius: 14px; padding: 20px 24px; margin-bottom: 20px; border: 1.5px solid var(--border); display: flex; gap: 10px; }
    .search-card input { flex: 1; padding: 10px 14px; border: 1.5px solid var(--border); border-radius: 10px; font-size: 14px; font-family: inherit; outline: none; transition: border-color 0.2s; }
    .search-card input:focus { border-color: var(--orange); }
    .search-card button { background: var(--orange); color: white; border: none; padding: 10px 22px; border-radius: 10px; font-size: 14px; font-weight: 700; cursor: pointer; font-family: inherit; transition: background 0.2s; white-space: nowrap; }
    .search-card button:hover { background: #FF6B35; }

    .order-card { background: white; border-radius: 16px; margin-bottom: 16px; border: 1.5px solid var(--border); overflow: hidden; transition: all 0.2s; }
    .order-card:hover { border-color: var(--orange); box-shadow: 0 4px 16px rgba(255,82,0,0.1); }
    .order-card-header { display: flex; align-items: center; justify-content: space-between; padding: 18px 22px; border-bottom: 1px solid var(--border); }
    .order-restaurant { display: flex; align-items: center; gap: 14px; }
    .r-avatar { width: 46px; height: 46px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 22px; flex-shrink: 0; }
    .r-avatar.italian { background: #FFF3E0; }
    .r-avatar.american { background: #E3F2FD; }
    .r-avatar.indian { background: #F3E5F5; }
    .order-restaurant h4 { font-size: 16px; font-weight: 700; }
    .order-restaurant p { font-size: 12px; color: var(--gray); margin-top: 3px; }
    .status-badge { padding: 5px 14px; border-radius: 20px; font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; }
    .status-badge.pending { background: #FFF8E1; color: #F57F17; }
    .status-badge.confirmed { background: #E3F2FD; color: #1565C0; }
    .status-badge.preparing { background: #FFF3E0; color: #E65100; }
    .status-badge.delivered { background: #E8F5E9; color: #2E7D32; }
    .status-badge.cancelled { background: #FFEBEE; color: #C62828; }
    .order-items-section { padding: 14px 22px; border-bottom: 1px solid var(--border); }
    .order-item-row { display: flex; justify-content: space-between; align-items: center; padding: 7px 0; border-bottom: 1px dashed var(--border); font-size: 14px; }
    .order-item-row:last-child { border-bottom: none; }
    .order-item-row .item-name { font-weight: 500; }
    .order-item-row .item-qty { color: var(--gray); font-size: 13px; }
    .order-item-row .item-price { font-weight: 700; }
    .order-card-footer { padding: 14px 22px; display: flex; align-items: center; justify-content: space-between; background: var(--light-gray); }
    .order-total { font-size: 17px; font-weight: 800; color: var(--orange); }
    .order-date { font-size: 12px; color: var(--gray); }
    .reorder-btn { background: var(--orange-pale); color: var(--orange); border: none; padding: 8px 18px; border-radius: 8px; font-size: 13px; font-weight: 700; cursor: pointer; font-family: inherit; transition: all 0.2s; }
    .reorder-btn:hover { background: var(--orange); color: white; }

    .empty-state { background: white; border-radius: 16px; padding: 70px 20px; text-align: center; border: 1.5px solid var(--border); }
    .empty-state .e-icon { font-size: 60px; margin-bottom: 16px; }
    .empty-state h3 { font-size: 20px; font-weight: 800; margin-bottom: 8px; }
    .empty-state p { color: var(--gray); font-size: 14px; margin-bottom: 24px; }
    .empty-state a { background: var(--orange); color: white; text-decoration: none; padding: 12px 28px; border-radius: 10px; font-weight: 700; }
  </style>
</head>
<body>

<nav>
  <a href="index.html" class="nav-logo">
    <div class="logo-icon">üçî</div>
    <span>Food<em>Express</em></span>
  </a>
  <a href="dashboard.html">‚Üê Dashboard</a>
</nav>

<div class="container">
  <div class="page-header">
    <h1>üìã My Orders</h1>
    <p>Your complete order history</p>
  </div>

  <div class="search-card">
    <input type="number" id="customer-id" placeholder="Enter Customer ID to view orders" />
    <button onclick="loadOrders()">View Orders</button>
  </div>

  <div id="orders-container"></div>
</div>

<script>
  const API = "http://localhost:8000";
  const user = JSON.parse(localStorage.getItem("user"));
  if (user) {
    document.getElementById("customer-id").value = user.id;
    loadOrders();
  }

  const cuisineMap = r => r?.includes('Pizza') ? 'italian' : r?.includes('Burger') ? 'american' : 'indian';
  const emojiMap = r => r?.includes('Pizza') ? 'üçï' : r?.includes('Burger') ? 'üçî' : 'üçõ';

  async function loadOrders() {
    const customerId = document.getElementById("customer-id").value;
    if (!customerId) return alert("Please enter a Customer ID");

    const container = document.getElementById("orders-container");
    container.innerHTML = `<div style="text-align:center;padding:40px;color:var(--gray)">Loading orders...</div>`;

    const res = await fetch(`${API}/orders/${customerId}`);
    const orders = await res.json();

    if (!orders.length) {
      container.innerHTML = `
        <div class="empty-state">
          <div class="e-icon">üçΩÔ∏è</div>
          <h3>No orders found</h3>
          <p>This customer hasn't placed any orders yet.</p>
          <a href="index.html">Start Ordering</a>
        </div>`;
      return;
    }

    container.innerHTML = orders.map(order => `
      <div class="order-card">
        <div class="order-card-header">
          <div class="order-restaurant">
            <div class="r-avatar ${cuisineMap(order.restaurant_name)}">${emojiMap(order.restaurant_name)}</div>
            <div>
              <h4>${order.restaurant_name}</h4>
              <p>Order #${order.order_id} &nbsp;¬∑&nbsp; ${order.items.length} item${order.items.length !== 1 ? 's' : ''}</p>
            </div>
          </div>
          <span class="status-badge ${order.status}">${order.status}</span>
        </div>
        <div class="order-items-section">
          ${order.items.map(item => `
            <div class="order-item-row">
              <span class="item-name">${item.name}</span>
              <span class="item-qty">√ó${item.quantity}</span>
              <span class="item-price">$${(item.price_at_order * item.quantity).toFixed(2)}</span>
            </div>`).join("")}
        </div>
        <div class="order-card-footer">
          <div>
            <div class="order-total">$${parseFloat(order.total_amount).toFixed(2)}</div>
            <div class="order-date">${new Date(order.created_at).toLocaleDateString('en-US', { weekday:'short', day:'numeric', month:'short', year:'numeric' })}</div>
          </div>
          <button class="reorder-btn" onclick="reorder(${order.restaurant_name ? `'${order.restaurant_name}'` : 'null'})">üîÅ Reorder</button>
        </div>
      </div>`).join("");
  }

  function reorder(restaurantName) {
    alert(`Redirecting to ${restaurantName} menu! üçΩÔ∏è`);
    window.location.href = "index.html";
  }
</script>
</body>
</html>